<!DOCTYPE HTML>
<html>
    <head>
        <title>Tree</title>
        <script src="underscore-1.1.7.js"></script>
        <script src="jquery-1.7.1.js"></script>
        <script src="backbone-0.5.3.js"></script>
        <script src="jquery-ui-1.8.17.custom.min.js"></script>
        <script src="jquery.ui.nestedSortable.js"></script>

        <!--<link rel="stylesheet" type="text/css" href="tree.css"/>-->
        <!--<script src="tree_item.js"></script>-->
        <script src="tree.js"></script>
        <!--<script src="tree_status_lists.js"></script>-->
        <script type="text/javascript">
            var list;
            $(document).ready(function() {
                var data = {
                    "title": "ROOT",
                    "children": [
                        new Folder({
                            "title": "Folder 1",
                            "children": [new MI(), new MI()]
                        }),
                        new Folder({
                            "title": "Folder 2",
                            "children": [
                                new Folder({
                                    "title": "Folder 3",
                                    "children": [new MI(), new MI(), new MI()]
                                }),
                                new MI()
                            ]
                        }),
                        new MI()
                    ]
                };
                var data_new = {
                    "title": "ROOTS MANUVA",
                    "children": [new MI(), new MI(), new MI(), new MI()]
                };
                list = new Folder(data);
                var listView = new FolderView({ model: list });
                $("#tree").html(listView.el);


                $('.sortable').nestedSortable({
                    disableNesting: 'module_item',
                    forcePlaceholderSize: true,
                    handle: 'div',
                    helper:	'clone',
                    items: 'li',
                    maxLevels: 30,
                    opacity: .6,
                    placeholder: 'placeholder',
                    revert: 250,
                    tabSize: 25,
                    tolerance: 'pointer',
                    toleranceElement: '> div'
                });
                $(".sortable").bind("sortupdate", function() {
                    var data = $(this).nestedSortable("toHierarchy");
                    console.log( data );

                    var update_order = function(data) {
                        var pnt = list.get_item_by_id( data["id"] );

                        for( var index in data["children"] ) {
                            var child_data = data["children"][index];
                            var child_item = list.get_item_by_id( child_data["id"] );
                            child_item.set_position(index, pnt);

                            if( child_data["children"] ) {
                                update_order( child_data );
                            }
                        }
                    }
                    update_order( data[0] );
                });
            });

        </script>

    </head>
    <body>
        <h1>Testing</h1>
        <ol class="sortable_new">
            <li><div>Some content</div></li>
            <li><div>Some content</div>
                <ol>
                    <li><div>Some sub-item content</div></li>
                    <li><div>Some sub-item content</div></li>
                </ol>
            </li>
            <li><div>Some content</div></li>
        </ol>
        <ol class="sortable" id="tree"></ol>
    </body>
</html>
